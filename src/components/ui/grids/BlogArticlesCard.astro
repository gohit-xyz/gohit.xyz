---
import { ArrowRightIcon, ExternalLinkIcon } from '@/components/icons/icons'

interface Props {
  articles: any[]
}

const { articles } = Astro.props

// Helper Functions
const formatDate = (date: Date | string) => {
  return new Date(date).toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'short',
    day: 'numeric',
  })
}
---

<div class="grid grid-cols-1 gap-8">
  {
    articles.map((article) => (
      <article class="group relative rounded-lg bg-transparent">
        <a href={`/blog/${article.slug}`} class="block h-full w-full">
          <div class="relative h-full overflow-hidden rounded-lg border border-gray-300 bg-white/90 backdrop-blur-sm transition-all duration-300 hover:border-gray-400 hover:bg-white hover:shadow-xl dark:border-gray-800 dark:bg-black/40 dark:hover:border-gray-700 dark:hover:bg-black/60">
            {/* Banner Image*/}
            {article.data.banner && (
              <div class="relative h-64 w-full overflow-hidden">
                <img
                  src={article.data.banner}
                  alt={`Banner for ${article.data.title}`}
                  class="h-full w-full object-cover transition-transform duration-500 group-hover:scale-110"
                  width="800"
                  height="192"
                  loading="lazy"
                />
                <div class="absolute inset-0 bg-linear-to-t from-black via-black/50 to-transparent opacity-60" />
              </div>
            )}

            {/* Card Content */}
            <div class="space-y-4 bg-white p-6 dark:bg-black">
              {/* Author & Date Row */}
              <div class="flex items-center justify-between">
                {/* Author Info */}
                <div class="flex items-center gap-3">
                  <img
                    src={article.data.profile || '/images/profile/user.png'}
                    alt={`${article.data.author}'s avatar`}
                    class="h-10 w-10 rounded-full border-2 border-gray-200 object-cover ring-2 ring-gray-100 dark:border-gray-800 dark:ring-black/50"
                    width="40"
                    height="40"
                    loading="lazy"
                  />
                  <div>
                    <p class="text-sm font-medium text-black dark:text-gray-300">
                      {article.data.author}
                    </p>
                    <time
                      class="text-xs text-gray-500 dark:text-gray-500"
                      datetime={
                        typeof article.data.publishDate === 'string'
                          ? article.data.publishDate
                          : article.data.publishDate.toISOString()
                      }
                    >
                      {formatDate(article.data.publishDate)}
                    </time>
                  </div>
                </div>

                {/* External Link Icon */}
                <ExternalLinkIcon className="h-5 w-5 text-blue-500 opacity-0 transition-opacity group-hover:opacity-100" />
              </div>

              {/* Article Title */}
              <h2 class="text-2xl leading-tight font-bold tracking-tight text-black transition-colors group-hover:text-blue-600 dark:text-white dark:group-hover:text-blue-400">
                {article.data.title}
              </h2>

              {/* Article Description */}
              {article.data.description && (
                <p class="line-clamp-2 text-sm leading-relaxed text-gray-600 dark:text-gray-400">
                  {article.data.description}
                </p>
              )}

              {/*  Tags*/}
              {article.data.tags && article.data.tags.length > 0 && (
                <div class="flex flex-wrap gap-2 pt-2">
                  {article.data.tags.slice(0, 3).map((tag: string) => (
                    <span class="rounded-full bg-gray-100 px-3 py-1 text-xs font-medium text-gray-700 ring-1 ring-gray-200 dark:bg-gray-900 dark:text-gray-400 dark:ring-gray-800">
                      {tag}
                    </span>
                  ))}
                  {article.data.tags.length > 3 && (
                    <span class="rounded-full bg-gray-100 px-3 py-1 text-xs font-medium text-gray-600 ring-1 ring-gray-200 dark:bg-gray-900 dark:text-gray-500 dark:ring-gray-800">
                      +{article.data.tags.length - 3}
                    </span>
                  )}
                </div>
              )}

              {/* Read More Link */}
              <div class="flex items-center gap-2 pt-2 text-sm font-medium text-blue-600 opacity-0 transition-opacity group-hover:opacity-100 dark:text-blue-400">
                <span>Read article</span>
                <ArrowRightIcon className="h-4 w-4 transition-transform group-hover:translate-x-1" />
              </div>
            </div>

            {/* Hover Border Effect */}
            <div class="absolute inset-0 rounded-lg opacity-0 ring-1 ring-blue-500/50 transition-opacity group-hover:opacity-100 dark:ring-blue-500/50" />
          </div>
        </a>
      </article>
    ))
  }
</div>

<style>
  /* Line Clamp Utility */
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  /* Prevent Text Flicker on Theme Transitions */
  h1,
  h2,
  h3,
  p,
  span,
  time {
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    backface-visibility: hidden;
    transform: translateZ(0);
    will-change: color;
  }

  /* ========== ANIMATIONS ========== */

  /* Staggered Fade-in for Articles */
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  article {
    animation: fadeInUp 0.5s ease-out forwards;
    opacity: 0;
  }

  article:nth-child(1) {
    animation-delay: 0.1s;
  }
  article:nth-child(2) {
    animation-delay: 0.2s;
  }
  article:nth-child(3) {
    animation-delay: 0.3s;
  }
  article:nth-child(4) {
    animation-delay: 0.4s;
  }
  article:nth-child(5) {
    animation-delay: 0.5s;
  }
  article:nth-child(6) {
    animation-delay: 0.6s;
  }
</style>
