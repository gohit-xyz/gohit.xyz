---
import Layout from '@/layouts/Layout.astro'
import { BackButtonOne } from '@/components/ui/ui'
import { Image } from 'astro:assets'
import { SPONSORS } from '@/data/x'
import SponsorXBtns from '@/components/ui/grids/SponsorXBtns.astro'

// Constants
const BRAND_COLOR = '#008b6c'
---

<Layout>
  <div
    class="page-wrapper custom-cursor flex min-h-screen w-full items-center justify-center py-6 sm:py-10"
  >
    <main class="relative w-full max-w-6xl px-3 sm:px-4 md:px-6">
      <!-- Back Button -->
      <div class="back-button-container mb-4 flex gap-2 sm:mb-8 sm:gap-3">
        <BackButtonOne href="/" text="Home" />
        <BackButtonOne text="/ã…¤Sponsors" showIcon={false} useHistory={true} />
      </div>

      <div class="grid gap-4 sm:gap-6 lg:grid-cols-12 lg:gap-8">
        <!-- Left Column: Sponsors List -->
        <div class="lg:col-span-5 xl:col-span-4">
          <div
            class="sponsors-list-container overflow-hidden rounded-xl border border-[#7e7e7e3a] backdrop-blur-xl sm:rounded-2xl"
          >
            <div class="border-b border-[#7e7e7e3a] p-3 text-center sm:p-4">
              <h2 class="text-base font-bold sm:text-lg">Future Sponsor</h2>
            </div>
            <SponsorXBtns sponsors={SPONSORS} />
          </div>
        </div>

        <!-- Right Column: Detail View -->
        <div class="lg:col-span-7 xl:col-span-8">
          <div
            class="sticky top-10 flex h-full min-h-[320px] flex-col items-center justify-center rounded-xl border border-[#7e7e7e3a] bg-white/5 p-3 text-center backdrop-blur-xl transition-all duration-500 sm:min-h-[400px] sm:rounded-2xl sm:p-4 md:min-h-[500px] md:p-8"
          >
            <div class="group relative mb-4 sm:mb-6 md:mb-8">
              <div
                class="absolute -inset-1 rounded-xl bg-linear-to-r from-[#008b6c] to-[#00d4aa] opacity-25 blur transition duration-1000 group-hover:opacity-50 group-hover:duration-200 sm:rounded-2xl"
              >
              </div>
              <div
                class="relative rounded-lg bg-white p-2 sm:rounded-xl sm:p-3 md:p-4 dark:bg-gray-900"
              >
                <Image
                  src={SPONSORS[0].qrImage}
                  alt="QR Code for {SPONSORS[0].name}"
                  class="h-32 w-32 rounded-lg object-cover shadow-2xl sm:h-48 sm:w-48 md:h-56 md:w-56 lg:h-64 lg:w-64"
                  id="qr-image"
                />
              </div>
            </div>

            <!-- QR Selector (only visible for sponsors with multiple QR codes) -->
            <div id="qr-selector" class="mb-3 hidden sm:mb-4 md:mb-6">
              <p class="mb-2 text-xs font-medium sm:mb-3 sm:text-sm">Select Cryptocurrency:</p>
              <div id="qr-buttons" class="flex flex-wrap justify-center gap-1.5 sm:gap-2">
                <!-- QR buttons will be dynamically inserted here -->
              </div>
            </div>

            <h2
              id="sponsor-name"
              class="mb-2 max-w-full px-2 text-lg font-bold wrap-break-word sm:text-2xl md:text-3xl"
            >
              {SPONSORS[0].name}
            </h2>
            <p
              id="sponsor-desc"
              class="mb-4 max-w-full px-3 text-xs opacity-80 sm:mb-6 sm:max-w-md sm:text-sm md:mb-8 md:text-base"
            >
              {SPONSORS[0].description}
            </p>

            <!-- Crypto Wallet ID (minimalist - only for cryptocurrency sponsors) -->
            <div id="crypto-wallet-container" class="hidden w-full max-w-md px-2">
              <div class="flex items-center gap-1.5 sm:gap-2">
                <input
                  id="wallet-id-input"
                  type="text"
                  readonly
                  value=""
                  class="flex-1 rounded-lg border border-[#7e7e7e3a] bg-white/5 px-2 py-2 font-mono text-xs backdrop-blur-sm focus:ring-2 focus:ring-[#008b6c] focus:outline-none sm:px-3 sm:py-2.5 sm:text-sm md:px-4 md:py-3"
                />
                <button
                  id="copy-wallet-btn"
                  class="group relative flex items-center justify-center rounded-lg bg-[#008b6c] p-2 text-white transition-all duration-300 hover:bg-[#007a5e] hover:shadow-[0_0_15px_rgba(0,139,108,0.4)] sm:p-2.5 md:p-3"
                  title="Copy wallet address"
                >
                  <svg
                    class="h-4 w-4 sm:h-5 sm:w-5"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"
                    ></path>
                  </svg>
                  <span id="copy-btn-text" class="sr-only">Copy</span>
                </button>
              </div>
            </div>

            <!-- Regular Link (for non-crypto sponsors) -->
            <a
              id="sponsor-link"
              href={SPONSORS[0].url || '#'}
              target="_blank"
              rel="noopener noreferrer"
              class="group relative inline-flex items-center justify-center gap-1.5 overflow-hidden rounded-full bg-[#008b6c] px-4 py-2.5 text-sm font-bold text-white transition-all duration-300 hover:-translate-y-1 hover:bg-[#007a5e] hover:shadow-[0_0_20px_rgba(0,139,108,0.4)] sm:gap-2 sm:px-6 sm:py-3 sm:text-base md:px-8 md:py-4 md:text-lg"
              style={!SPONSORS[0].url || SPONSORS[0].isCrypto ? 'display: none;' : ''}
            >
              <span class="relative z-10">Go to Official Page</span>
              <svg
                class="relative z-10 h-4 w-4 transition-transform duration-300 group-hover:translate-x-1 sm:h-5 sm:w-5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
              </svg>
            </a>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- ==================== 
     MARK: SCRIPT
     ==================== -->
  <script>
    // ==================== DOM Elements ====================
    document.addEventListener('DOMContentLoaded', () => {
      const buttons = document.querySelectorAll('.sponsor-item')
      const sponsorName = document.getElementById('sponsor-name')
      const sponsorDesc = document.getElementById('sponsor-desc')
      const sponsorLink = document.getElementById('sponsor-link') as HTMLAnchorElement
      const qrImage = document.getElementById('qr-image') as HTMLImageElement
      const qrSelector = document.getElementById('qr-selector')
      const qrButtonsContainer = document.getElementById('qr-buttons')
      const cryptoWalletContainer = document.getElementById('crypto-wallet-container')
      const walletIdInput = document.getElementById('wallet-id-input') as HTMLInputElement
      const copyWalletBtn = document.getElementById('copy-wallet-btn')
      const copyBtnText = document.getElementById('copy-btn-text')

      // ==================== State Variables ====================
      let currentQrImages: string[] = []
      let currentQrLabels: string[] = []
      let currentWalletIds: string[] = []
      let currentSelectedCryptoIndex = 0

      // ==================== Copy to Clipboard ====================
      if (copyWalletBtn) {
        copyWalletBtn.addEventListener('click', async () => {
          const walletId = walletIdInput?.value
          if (!walletId) return

          try {
            await navigator.clipboard.writeText(walletId)

            // Visual feedback - change button color temporarily
            copyWalletBtn.classList.add('!bg-green-600')
            setTimeout(() => {
              copyWalletBtn.classList.remove('!bg-green-600')
            }, 1500)
          } catch (err) {
            console.error('Failed to copy:', err)
            // Error feedback
            copyWalletBtn.classList.add('!bg-red-600')
            setTimeout(() => {
              copyWalletBtn.classList.remove('!bg-red-600')
            }, 1500)
          }
        })
      }

      // ==================== QR Code Management ====================
      function createQrButtons(images: string[], labels: string[], walletIds: string[] = []) {
        if (!qrButtonsContainer) return

        qrButtonsContainer.innerHTML = ''

        images.forEach((imgSrc, index) => {
          const btn = document.createElement('button')
          btn.className = `qr-option-btn cursor-pointer px-4 py-2 rounded-lg font-medium transition-all duration-300 ${
            index === 0 ? 'bg-[#008b6c] text-white shadow-lg' : 'bg-white/10 hover:bg-white/20'
          }`
          btn.textContent = labels[index] || `Option ${index + 1}`
          btn.dataset.qrSrc = imgSrc
          btn.dataset.index = index.toString()

          btn.addEventListener('click', () => {
            currentSelectedCryptoIndex = index

            // Update QR image
            if (qrImage) {
              qrImage.src = imgSrc
            }

            // Update wallet ID if available
            if (walletIds.length > index && walletIdInput) {
              walletIdInput.value = walletIds[index]
            }

            // Update button styles
            qrButtonsContainer.querySelectorAll('.qr-option-btn').forEach((b) => {
              b.classList.remove('bg-[#008b6c]', 'text-white', 'shadow-lg')
              b.classList.add('bg-white/10')
            })
            btn.classList.remove('bg-white/10')
            btn.classList.add('bg-[#008b6c]', 'text-white', 'shadow-lg')
          })

          qrButtonsContainer.appendChild(btn)
        })
      }

      // ==================== Sponsor Selection Handlers ====================
      buttons.forEach((button) => {
        button.addEventListener('click', () => {
          // Remove active class from all buttons
          buttons.forEach((btn) => {
            btn.classList.remove(
              'active',
              'border-[#008b6c]',
              'bg-[#008b6c]/10',
              'ring-1',
              'ring-[#008b6c]'
            )
            btn.classList.add('border-transparent', 'bg-white/5', 'dark:bg-white/5')

            // Reset text color
            const textSpan = btn.querySelector('span')
            if (textSpan) {
              textSpan.classList.remove('text-[#008b6c]', 'font-bold')
            }

            // Reset radio indicator
            const radio = btn.querySelector('.radio-indicator')
            if (radio) {
              radio.classList.remove('border-[#008b6c]', 'bg-[#008b6c]')
              radio.classList.add('border-gray-400')
              const dot = radio.querySelector('div')
              if (dot) dot.classList.remove('opacity-100')
            }
          })

          // Add active class to clicked button
          button.classList.add(
            'active',
            'border-[#008b6c]',
            'bg-[#008b6c]/10',
            'ring-1',
            'ring-[#008b6c]'
          )
          button.classList.remove('border-transparent', 'bg-white/5', 'dark:bg-white/5')

          const textSpan = button.querySelector('span')
          if (textSpan) {
            textSpan.classList.add('text-[#008b6c]', 'font-bold')
          }

          const radio = button.querySelector('.radio-indicator')
          if (radio) {
            radio.classList.remove('border-gray-400')
            radio.classList.add('border-[#008b6c]', 'bg-[#008b6c]')
            const dot = radio.querySelector('div')
            if (dot) dot.classList.add('opacity-100')
          }

          // Update details
          const name = button.getAttribute('data-name')
          const url = button.getAttribute('data-url')
          const hasUrl = button.getAttribute('data-has-url') === 'true'
          const desc = button.getAttribute('data-desc')
          const qrSrc = button.getAttribute('data-qr-src')
          const hasMultiple = button.getAttribute('data-has-multiple') === 'true'
          const qrImagesStr = button.getAttribute('data-qr-images')
          const qrLabelsStr = button.getAttribute('data-qr-labels')
          const isCrypto = button.getAttribute('data-is-crypto') === 'true'
          const walletIdsStr = button.getAttribute('data-wallet-ids')

          if (sponsorName) sponsorName.textContent = name || ''
          if (sponsorDesc) sponsorDesc.textContent = desc || ''
          if (sponsorLink && url) sponsorLink.href = url

          // Handle crypto vs non-crypto display
          if (isCrypto && walletIdsStr) {
            // Show crypto wallet container, hide regular link
            if (cryptoWalletContainer) cryptoWalletContainer.classList.remove('hidden')
            if (sponsorLink) {
              sponsorLink.classList.add('hidden')
              sponsorLink.style.display = 'none' // Force hide
            }

            currentWalletIds = walletIdsStr ? JSON.parse(walletIdsStr) : []

            // Set initial wallet ID
            if (walletIdInput && currentWalletIds.length > 0) {
              walletIdInput.value = currentWalletIds[0]
            }
          } else {
            // Hide crypto wallet container
            if (cryptoWalletContainer) cryptoWalletContainer.classList.add('hidden')

            // Show or hide regular link based on whether URL exists
            if (sponsorLink) {
              if (hasUrl && url) {
                sponsorLink.classList.remove('hidden')
                sponsorLink.style.display = '' // Reset to CSS (inline-flex)
              } else {
                sponsorLink.classList.add('hidden')
                sponsorLink.style.display = 'none' // Force hide
              }
            }
          }

          // Handle multiple QR codes
          if (hasMultiple && qrImagesStr && qrLabelsStr) {
            currentQrImages = JSON.parse(qrImagesStr)
            currentQrLabels = JSON.parse(qrLabelsStr)
            currentSelectedCryptoIndex = 0

            // Show QR selector and create buttons
            if (qrSelector) qrSelector.classList.remove('hidden')
            createQrButtons(currentQrImages, currentQrLabels, currentWalletIds)

            // Set first QR as default
            if (qrImage && currentQrImages[0]) {
              qrImage.src = currentQrImages[0]
              qrImage.alt = `QR Code for ${name}`
            }
          } else {
            // Hide QR selector for single QR sponsors
            if (qrSelector) qrSelector.classList.add('hidden')

            // Update QR code image and alt text
            if (qrImage && qrSrc) {
              qrImage.src = qrSrc
              qrImage.alt = `QR Code for ${name}`
            }
          }

          // Animation effect for content change
          const rightColumn = document.querySelector('.lg\\:col-span-7 > div')
          if (rightColumn) {
            rightColumn.animate(
              [
                { opacity: 0.8, transform: 'scale(0.98)' },
                { opacity: 1, transform: 'scale(1)' },
              ],
              {
                duration: 300,
                easing: 'ease-out',
              }
            )
          }
        })
      })
    })
  </script>
</Layout>
