---
// Imports
import Layout from '@/layouts/Layout.astro'
import { getCollection } from 'astro:content'
import { ArrowBackIcon, ShareIcon, TimeIcon } from '@/components/icons/icons'
import BackButtonTwo from '@/components/ui/buttons/BackButtonTwo.astro'

// Static Paths Generation
export async function getStaticPaths() {
  const articles = await getCollection('articles')
  return articles.map((article) => ({
    params: { slug: article.slug },
    props: { article },
  }))
}

// Props & Data
const { article } = Astro.props
const { Content } = await article.render()

// Reading Time Calculation
const WORDS_PER_MINUTE = 200
const wordCount = article.body.split(/\s+/).length
const readingTime = Math.ceil(wordCount / WORDS_PER_MINUTE)

// Format Date
const formattedDate = new Date(article.data.publishDate).toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'short',
  day: 'numeric',
})
---

<Layout>
  <article class="relative mx-auto max-w-5xl px-6 py-16 lg:px-8">
    
    <!-- ========== DECORATIVE ELEMENTS ========== -->
    
    <!-- Vertical Lines - Left -->
    <div class="absolute left-0 top-0 hidden h-full w-px bg-linear-to-b from-gray-800 via-gray-700 to-transparent lg:block"></div>
    <div class="absolute left-20 top-0 hidden h-full w-px bg-linear-to-b from-transparent via-gray-800 to-transparent opacity-50 lg:block"></div>

    <!-- Vertical Lines - Right -->
    <div class="absolute right-0 top-0 hidden h-full w-px bg-linear-to-b from-gray-800 via-gray-700 to-transparent lg:block"></div>
    <div class="absolute right-20 top-0 hidden h-full w-px bg-linear-to-b from-transparent via-gray-800 to-transparent opacity-50 lg:block"></div>

    <!-- Corner Decorations - Top -->
    <div class="absolute left-0 top-0 h-16 w-16 border-l-2 border-t-2 border-gray-800 opacity-60"></div>
    <div class="absolute right-0 top-0 h-16 w-16 border-r-2 border-t-2 border-gray-800 opacity-60"></div>

    <!-- Corner Decorations - Bottom -->
    <div class="absolute bottom-0 left-0 h-16 w-16 border-b-2 border-l-2 border-gray-800 opacity-60"></div>
    <div class="absolute bottom-0 right-0 h-16 w-16 border-b-2 border-r-2 border-gray-800 opacity-60"></div>

    <!-- ========== MAIN CONTENT ========== -->
    
    <div class="relative z-10">
      
      <!-- Breadcrumb Navigation -->
      <nav class="mb-12 flex items-center justify-center gap-2 text-sm text-gray-400">
        <BackButtonTwo href="/article" text="Articles â—‰" />
      </nav>

      <!-- ========== HEADER SECTION ========== -->
      
      <header class="mb-16 text-center">
        
        <!-- Title -->
        <h1 class="mb-12 text-5xl font-bold leading-tight tracking-tight lg:text-6xl">
          {article.data.title}
        </h1>

        <!-- Author Avatar -->
        <div class="mb-12 flex justify-center">
          <div class="flex -space-x-3">
            <a href="/">
              <img
                src={article.data.profile || '/src/assets/images/test/user.png'}
                alt={`${article.data.author || 'Author'}'s avatar`}
                class="h-12 w-12 rounded-full border-4 border-black object-cover shadow-xl ring-2 ring-gray-800 grayscale-0 hover:grayscale"
                loading="lazy"
              />
            </a>
          </div>
        </div>

        <!-- Divider -->
        <div class="mx-auto mb-8 h-px w-full max-w-4xl bg-linear-to-r from-transparent via-gray-800 to-transparent"></div>

        <!-- Meta Information -->
        <div class="flex flex-wrap items-center justify-center gap-6 text-sm text-gray-400">
          
          <!-- Reading Time -->
          <div class="flex items-center gap-2">
            <TimeIcon className="h-4 w-4" />
            <span>{readingTime} min read</span>
          </div>

          <!-- External URL -->
          {article.data.url && (
            <a
              href={article.data.url}
              target="_blank"
              rel="noopener noreferrer"
              class="flex items-center gap-2 text-blue-400 transition-colors hover:text-blue-300"
              title="Open external URL"
            >
              <ShareIcon className="h-4 w-4" />
              <span>Open URL</span>
            </a>
          )}

          <!-- Publish Date -->
          <time datetime={article.data.publishDate.toString()} class="text-gray-500">
            {formattedDate}
          </time>
        </div>
      </header>

      <!-- Section Divider with Diamond -->
      <div class="relative mx-auto mb-12 max-w-4xl">
        <div class="h-px w-full bg-linear-to-r from-transparent via-gray-800 to-transparent"></div>
        <div class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2">
          <div class="h-2 w-2 rotate-45 border border-gray-700 bg-black"></div>
        </div>
      </div>

      <!-- ========== CONTENT SECTION ========== -->
      
      <div class="prose prose-invert prose-lg prose-headings:font-bold prose-headings:tracking-tight prose-h2:mb-6 prose-h2:mt-12 prose-h2:text-3xl prose-h3:mb-4 prose-h3:mt-8 prose-p:leading-relaxed prose-p:text-gray-300 prose-a:text-blue-400 prose-a:no-underline hover:prose-a:text-blue-300 prose-strong:text-white prose-code:rounded prose-code:bg-gray-900 prose-code:px-2 prose-code:py-1 prose-code:text-blue-400 prose-pre:border prose-pre:border-gray-800 prose-pre:bg-gray-900 mx-auto max-w-3xl">
        
        <!-- Description/Lead -->
        {article.data.description && (
          <p class="lead mb-10 text-xl leading-relaxed text-gray-400">
            {article.data.description}
          </p>
        )}

        <!-- Article Content -->
        <Content />
      </div>

      <!-- ========== TAGS SECTION ========== -->
      
      {article.data.tags && article.data.tags.length > 0 && (
        <footer class="mx-auto mt-16 max-w-3xl border-t border-gray-800 pt-8">
          <div class="flex flex-wrap gap-2">
            {article.data.tags.map((tag: string) => (
              <a
                href={`/tags/${tag.toLowerCase()}`}
                class="rounded-full bg-gray-900 px-4 py-2 text-sm text-gray-300 ring-1 ring-gray-800 transition-all hover:bg-gray-800 hover:ring-gray-700"
              >
                {tag}
              </a>
            ))}
          </div>
        </footer>
      )}
    </div>
  </article>
</Layout>

<style>
  /* Fade-in animation for top border */
  @keyframes fadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  article::before {
    content: '';
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 100%;
    max-width: 1200px;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(156, 163, 175, 0.3), transparent);
    animation: fadeIn 1s ease-in;
  }
</style>
