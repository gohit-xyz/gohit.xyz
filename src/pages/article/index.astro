---
import Layout from '@/layouts/Layout.astro'
import { getCollection } from 'astro:content'
import { ArrowLeftIcon } from '@/components/icons/icons'
import ThemeToggle from '@/components/ThemeToggle'

const articles = await getCollection('articles', ({ data }) => {
  return data.draft !== true
})

const sortedArticles = articles.sort((a, b) => {
  return new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime()
})
---

<Layout>
  <div class="custom-cursor flex min-h-screen w-full items-center justify-center">
    <main class="relative w-full max-w-4xl px-4 py-2 sm:px-6">
      <!-- Title -->
      <div class="mb-8 flex items-center gap-3">
        <a href="/">
          <ArrowLeftIcon className="h-8 w-8 opacity-60 hover:opacity-80" />
        </a>
        <h1 class="text-4xl font-bold">Articles</h1>
      </div>

      <!-- Theme toggle -->
      <ThemeToggle client:idle />

      <!-- Article -->
      <div class="grid gap-6">
        {
          sortedArticles.map((article) => (
            <article class="style rounded-lg border border-gray-200 p-6 transition hover:shadow-lg">
              <a href={`/article/${article.slug}`} class="block">
                <h2 class="mb-2 text-2xl font-bold hover:text-blue-600">{article.data.title}</h2>
                <p class="mb-4 text-gray-600">{article.data.description}</p>
                <div class="flex items-center gap-4 text-sm text-gray-500">
                  <time datetime={article.data.publishDate.toString()}>
                    {new Date(article.data.publishDate).toLocaleDateString('es-ES', {
                      year: 'numeric',
                      month: 'long',
                      day: 'numeric',
                    })}
                  </time>
                  {article.data.tags && (
                    <div class="flex flex-wrap gap-2">
                      {article.data.tags.map((tag) => (
                        <span class="rounded-full bg-gray-200 px-2 py-1 text-xs">{tag}</span>
                      ))}
                    </div>
                  )}
                </div>
              </a>
            </article>
          ))
        }
      </div>
    </main>
  </div>

  <style>
    /* Theme Toggle Icon */
    :global(.theme-toggle) {
      position: absolute;
      top: 15px;
      right: 21px;
      background-color: #4a4a4a3a;
      border-radius: 50%;
      padding: 6px;
      cursor: pointer;
      border: 1px solid rgba(65, 65, 65, 0.2);
      transition: all 0.3s ease;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      z-index: 20;
    }

    :global(.theme-toggle:hover) {
      background-color: #4a4a4a73;
      border-color: rgba(255, 255, 255, 0.4);
    }

    :global(.theme-toggle:active) {
      background-color: #3a3a3a;
    }

    :global(.theme-toggle svg) {
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
      transition: transform 0.3s ease;
      width: 22px;
      height: 22px;
    }

    :global(.theme-toggle:hover svg) {
      transform: rotate(15deg) scale(1.1);
    }
    .style {
      background-color: white;
    }
  </style>
</Layout>
