---
import Layout from '@/layouts/Layout.astro'
import ThemeToggle from '@/components/ThemeToggle'
import { getCollection } from 'astro:content'
import { ArrowLeftIcon } from '@/components/icons/icons'

const articles = await getCollection('articles', ({ data }) => {
  return data.draft !== true
})

const sortedArticles = articles.sort((a, b) => {
  return new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime()
})
---

<Layout>
  <div class="custom-cursor flex min-h-screen w-full items-center justify-center">
    <main class="relative mt-10 mb-10 w-full max-w-4xl px-4 py-2 sm:px-6">
      <!-- Title -->
      <div class="mb-8 flex items-center gap-3">
        <a href="/" aria-label="back">
          <ArrowLeftIcon className="h-8 w-8 opacity-60 transition-opacity hover:opacity-80" />
        </a>
        <h1 class="text-4xl font-bold">My articles</h1>
      </div>

      <!-- Theme toggle -->
      <ThemeToggle client:idle />

      <!-- Articles List -->
      <div class="grid gap-6">
        {
          sortedArticles.map((article) => (
            <article class="group">
              <a href={`/article/${article.slug}`} class="block">
                {/* Banner Image */}
                {article.data.banner && (
                  <div class="banner-container h-[250px] w-full overflow-hidden rounded-t-lg">
                    <img
                      src={article.data.banner}
                      alt={`Banner de ${article.data.title}`}
                      class="banner-image h-full w-full object-cover object-center"
                      loading="lazy"
                    />
                  </div>
                )}

                {/* Article Content */}
                <div
                  class={`bg-white/90 pt-6 pr-6 pb-6 pl-6 text-black transition-shadow hover:shadow-lg ${article.data.banner ? 'rounded-b-lg' : 'rounded-lg'}`}
                >
                  {/* Author Info */}
                  <div class="mb-4 flex items-center gap-2">
                    <img
                      src={article.data.profile || '/src/assets/images/test/user.png'}
                      alt={`Picture ${article.data.author}`}
                      class="h-10 w-10 rounded-full object-cover shadow-md"
                      loading="lazy"
                    />
                    <div class="flex flex-col gap-0">
                      <h2 class="leading-tight font-medium text-black/80">{article.data.author}</h2>
                      <time
                        class="text-[15px] leading-tight text-black/60"
                        datetime={
                          typeof article.data.publishDate === 'string'
                            ? article.data.publishDate
                            : article.data.publishDate.toISOString()
                        }
                      >
                        {new Date(article.data.publishDate).toLocaleDateString('en-US', {
                          month: 'short',
                          day: 'numeric',
                        })}
                      </time>
                    </div>
                  </div>

                  {/* Title */}
                  <div class="px-4">
                    <h3 class="mb-3 text-2xl font-bold text-black transition-colors group-hover:text-orange-600">
                      {article.data.title}
                    </h3>

                    {/* Tags */}
                    {article.data.tags && article.data.tags.length > 0 && (
                      <div class="flex flex-wrap gap-2">
                        {article.data.tags.map((tag) => (
                          <span class="rounded-[10px] bg-white px-2 py-1 text-xs font-medium text-gray-700">
                            {tag}
                          </span>
                        ))}
                      </div>
                    )}
                  </div>
                </div>
              </a>
            </article>
          ))
        }
      </div>
    </main>
  </div>
</Layout>

<style>
  /* Theme Toggle Icon */
  :global(.theme-toggle) {
    position: absolute;
    top: 1rem;
    right: 1.5rem;
    background-color: #4a4a4a3a;
    border-radius: 50%;
    padding: 6px;
    cursor: pointer;
    border: 1px solid rgba(65, 65, 65, 0.2);
    transition: all 0.3s ease;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    z-index: 20;
  }

  :global(.theme-toggle:hover) {
    background-color: #4a4a4a73;
    border-color: rgba(255, 255, 255, 0.4);
  }

  :global(.theme-toggle:active) {
    background-color: #3a3a3a;
    transform: scale(0.95);
  }

  :global(.theme-toggle svg) {
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
    transition: transform 0.3s ease;
    width: 22px;
    height: 22px;
  }

  :global(.theme-toggle:hover svg) {
    transform: rotate(15deg) scale(1.1);
  }

  /* Banner Effects */
  .banner-container {
    position: relative;
    overflow: hidden;
  }

  .banner-image {
    transition: transform 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    will-change: transform;
  }

  article:hover .banner-image {
    transform: scale(1.1);
  }

  /* Responsive adjustments */
  @media (max-width: 640px) {
    :global(.theme-toggle) {
      top: 0.75rem;
      right: 1rem;
      padding: 5px;
    }

    :global(.theme-toggle svg) {
      width: 20px;
      height: 20px;
    }
  }
</style>
