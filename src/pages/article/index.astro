---
import Layout from '@/layouts/Layout.astro'
import ThemeToggle from '@/components/ThemeToggle'
import { getCollection } from 'astro:content'
import { ArrowLeftIcon } from '@/components/icons/icons'
import Footer from '@/sections/shared/Footer.astro'

const articles = await getCollection('articles', ({ data }) => {
  return data.draft !== true
})

const sortedArticles = articles.sort((a, b) => {
  return new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime()
})
---

<Layout>
  <div class="relative min-h-screen w-full">
    <!-- Decorative background lines -->
    <div
      class="absolute top-0 left-110 hidden h-full w-px bg-linear-to-b from-transparent via-gray-600 to-transparent opacity-50 lg:block"
    >
    </div>
    <div
      class="absolute top-0 right-110 hidden h-full w-px bg-linear-to-b from-transparent via-gray-600 to-transparent opacity-50 lg:block"
    >
    </div>
    <div
      class="fixed top-0 left-0 h-full w-px bg-linear-to-b from-gray-800 via-gray-700 to-transparent opacity-30"
    >
    </div>

    <!-- Top decorative line -->
    <div
      class="fixed top-0 left-0 h-px w-full bg-linear-to-r from-transparent via-gray-800 to-transparent"
    >
    </div>

    <main class="relative mx-auto max-w-4xl px-6 pt-8 pb-2 lg:px-8">
      <ThemeToggle client:idle />

      <!-- Header section -->
      <header class="mb-16">
        <div class="mb-8 flex items-center gap-4">
          <a
            href="/"
            aria-label="back"
            class="group flex items-center gap-2 text-gray-600 transition-colors hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-500"
          >
            <ArrowLeftIcon className="h-5 w-5 transition-transform group-hover:-translate-x-1" />
            <span class="text-sm">Back</span>
          </a>
        </div>

        <div class="space-y-4">
          <h1 class="text-5xl font-bold tracking-tight lg:text-6xl">Articles</h1>
          <p class="text-xl text-gray-600 dark:text-gray-400">
            Thoughts, insights, and learnings from our journey
          </p>
        </div>

        <div
          class="mt-8 h-px w-full bg-linear-to-r from-transparent via-gray-300 to-transparent dark:via-gray-800"
        >
        </div>
      </header>

      <!-- Articles grid -->
      <div class="grid grid-cols-1 gap-8">
        {
          sortedArticles.map((article) => (
            <article class="group relative rounded-lg bg-black">
              <a href={`/article/${article.slug}`} class="block h-full w-full">
                <div class="relative h-full overflow-hidden rounded-lg border border-gray-300 bg-white/90 backdrop-blur-sm transition-all duration-300 hover:border-gray-400 hover:bg-white hover:shadow-xl dark:border-gray-800 dark:bg-black/40 dark:hover:border-gray-700 dark:hover:bg-black/60">
                  {/* Banner image */}
                  {article.data.banner && (
                    <div class="relative h-48 w-full overflow-hidden">
                      <img
                        src={article.data.banner}
                        alt={`Banner for ${article.data.title}`}
                        class="h-full w-full object-cover transition-transform duration-500 group-hover:scale-110"
                        loading="lazy"
                      />
                      <div class="absolute inset-0 bg-linear-to-t from-black via-black/50 to-transparent opacity-60" />
                    </div>
                  )}

                  {/* Content */}
                  <div class="space-y-4 bg-black p-6">
                    {/* Author and date */}
                    <div class="flex items-center justify-between">
                      <div class="flex items-center gap-3">
                        <img
                          src={article.data.profile || '/src/assets/images/test/user.png'}
                          alt={`${article.data.author}'s avatar`}
                          class="h-10 w-10 rounded-full border-2 border-gray-200 object-cover ring-2 ring-gray-100 dark:border-gray-800 dark:ring-black/50"
                          loading="lazy"
                        />
                        <div>
                          <p class="text-sm font-medium text-gray-800 dark:text-gray-300">
                            {article.data.author}
                          </p>
                          <time
                            class="text-xs text-gray-500 dark:text-gray-500"
                            datetime={
                              typeof article.data.publishDate === 'string'
                                ? article.data.publishDate
                                : article.data.publishDate.toISOString()
                            }
                          >
                            {new Date(article.data.publishDate).toLocaleDateString('en-US', {
                              year: 'numeric',
                              month: 'short',
                              day: 'numeric',
                            })}
                          </time>
                        </div>
                      </div>

                      {/* External link icon */}
                      {article.data.url && (
                        <svg
                          class="h-5 w-5 text-blue-500 opacity-0 transition-opacity group-hover:opacity-100 dark:text-blue-400"
                          fill="none"
                          viewBox="0 0 24 24"
                          stroke="currentColor"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"
                          />
                        </svg>
                      )}
                    </div>

                    {/* Title */}
                    <h2 class="text-2xl leading-tight font-bold tracking-tight text-black transition-colors group-hover:text-blue-600 dark:text-white dark:group-hover:text-blue-400">
                      {article.data.title}
                    </h2>

                    {/* Description */}
                    {article.data.description && (
                      <p class="line-clamp-2 text-sm leading-relaxed text-gray-600 dark:text-gray-400">
                        {article.data.description}
                      </p>
                    )}

                    {/* Tags */}
                    {article.data.tags && article.data.tags.length > 0 && (
                      <div class="flex flex-wrap gap-2 pt-2">
                        {article.data.tags.slice(0, 3).map((tag) => (
                          <span class="rounded-full bg-gray-100 px-3 py-1 text-xs font-medium text-gray-700 ring-1 ring-gray-200 dark:bg-gray-900 dark:text-gray-400 dark:ring-gray-800">
                            {tag}
                          </span>
                        ))}
                        {article.data.tags.length > 3 && (
                          <span class="rounded-full bg-gray-100 px-3 py-1 text-xs font-medium text-gray-600 ring-1 ring-gray-200 dark:bg-gray-900 dark:text-gray-500 dark:ring-gray-800">
                            +{article.data.tags.length - 3}
                          </span>
                        )}
                      </div>
                    )}

                    {/* Read more */}
                    <div class="flex items-center gap-2 pt-2 text-sm font-medium text-blue-600 opacity-0 transition-opacity group-hover:opacity-100 dark:text-blue-400">
                      <span>Read article</span>
                      <svg
                        class="h-4 w-4 transition-transform group-hover:translate-x-1"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M9 5l7 7-7 7"
                        />
                      </svg>
                    </div>
                  </div>

                  {/* Hover border effect */}
                  <div class="absolute inset-0 rounded-lg opacity-0 ring-1 ring-blue-500/50 transition-opacity group-hover:opacity-100 dark:ring-blue-500/50" />
                </div>
              </a>
            </article>
          ))
        }
      </div>

      {/* Empty state */}
      {
        sortedArticles.length === 0 && (
          <div class="flex min-h-[400px] items-center justify-center">
            <div class="text-center">
              <p class="text-xl text-gray-500 dark:text-gray-500">No articles published yet.</p>
              <p class="mt-2 text-sm text-gray-400 dark:text-gray-600">
                Check back soon for new content!
              </p>
            </div>
          </div>
        )
      }

      <div
        class="mt-16 h-px w-full bg-linear-to-r from-transparent via-gray-300 to-transparent dark:via-gray-800"
      >
      </div>
      <Footer />
    </main>
  </div>
</Layout>

<style>
  /* Theme toggle styling */
  :global(.theme-toggle) {
    position: absolute;
    top: 3rem;
    right: 1.5rem;
    background-color: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(10px);
    border-radius: 50%;
    padding: 10px;
    cursor: pointer;
    border: 1px solid rgba(75, 85, 99, 0.3);
    transition: all 0.3s ease;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
    z-index: 50;
  }

  :global(.theme-toggle:hover) {
    background-color: rgba(0, 0, 0, 0.8);
    border-color: rgba(156, 163, 175, 0.5);
    transform: rotate(15deg) scale(1.05);
  }

  :global(.theme-toggle svg) {
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
    transition: transform 0.3s ease;
    width: 20px;
    height: 20px;
  }

  html {
    scroll-behavior: smooth;
  }

  /* Line clamp utility */
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  /* Prevent text flicker on theme transitions */
  h1,
  h2,
  h3,
  p,
  span,
  time {
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    backface-visibility: hidden;
    transform: translateZ(0);
    will-change: color;
  }

  @media (max-width: 768px) {
    :global(.theme-toggle) {
      top: 1rem;
      right: 1rem;
      padding: 8px;
    }

    :global(.theme-toggle svg) {
      width: 18px;
      height: 18px;
    }
  }

  /* Staggered fade-in animation for articles */
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  article {
    animation: fadeInUp 0.5s ease-out forwards;
    opacity: 0;
  }

  article:nth-child(1) {
    animation-delay: 0.1s;
  }
  article:nth-child(2) {
    animation-delay: 0.2s;
  }
  article:nth-child(3) {
    animation-delay: 0.3s;
  }
  article:nth-child(4) {
    animation-delay: 0.4s;
  }
  article:nth-child(5) {
    animation-delay: 0.5s;
  }
  article:nth-child(6) {
    animation-delay: 0.6s;
  }
</style>
